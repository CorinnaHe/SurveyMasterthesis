{% extends "global/Page.html" %}
{% load otree %}

{% block content %}
<link rel="stylesheet" href="{{ static 'global/style.css' }}">


<input type="hidden" name="page_duration_stage2" id="page_duration_stage2"/>

<script>
var startTime;
window.onload = function() {
    startTime = Date.now();
};
function getTime(){
    var page_duration_stage2 = Date.now() - startTime;
    document.getElementById('page_duration_stage2').value = page_duration_stage2/1000;
}

</script>

<h2>{{ trial_label }} l {{ trial_number }} â€“ Stage 2: Final Decision</h2>

<!-- ========================= -->
<!-- Task reminder -->
<!-- ========================= -->

<p>
You are assessing a credit application.
Please review the applicant information below and make your final decision,
taking into account the AI assessment.
</p>

<hr>

<!-- ========================= -->
<!-- Applicant features (same as Stage 1) -->
<!-- ========================= -->

<h3>Applicant {{ trial_number }}</h3>

<p><strong>Sociodemographic information</strong></p>
<ul>
    {% for f in features %}
        {% if f.group == "Demographic information" %}
            <li>
                <strong>{{ f.label }}:</strong> {{ f.value }}
            </li>
        {% endif %}
    {% endfor %}
</ul>

<p><strong>Financial situation</strong></p>
<ul>
    {% for f in features %}
        {% if f.group == "Financial information" %}
            <li>
                <strong>{{ f.label }}:</strong> {{ f.value }}
            </li>
        {% endif %}
    {% endfor %}
</ul>

<p><strong>Credit-related information</strong></p>
<ul>
    {% for f in features %}
        {% if f.group == "Credit information" %}
            <li>
                <strong>{{ f.label }}:</strong> {{ f.value }}
            </li>
        {% endif %}
    {% endfor %}
</ul>

<br>

<p>
You <strong>initially</strong> classified this applicant as:
</p>

<p>{{ initial_decision_label }}</p>

<hr>

<!-- ========================= -->
<!-- AI support -->
<!-- ========================= -->

<div class="ai-support-box">

    <div class="ai-support-header">
        <span class="ai-icon">ðŸ¤–</span>
        <span class="ai-title">AI Support</span>
    </div>

    {% if condition == "C1" %}

    <p>
        Based on the available information, the AI predicts:
    </p>

    <p class="ai-prediction">
        â†’ {{ ai_label }}
    </p>

    <p>
        Out of <strong>100 similar past cases</strong>, predictions like this were
        <strong>correct in about {{ ai_correct_predictions }} cases</strong>
        and
        <strong>incorrect in about {{ ai_incorrect_predictions }} cases</strong>.
    </p>

    {% elif condition == "C2" %}

    <p>
        Based on the available information, the AI predicts:
    </p>

    <p class="ai-prediction">
        â†’ {{ ai_label }}
    </p>

    <p>
        The AI has <strong>{{ ai_confidence_level }}</strong> confidence in this prediction.
    </p>

    {% elif condition == "C3" %}

    <p>
        Based on the available information, the AI identifies the following outcomes as plausible:
    </p>

    <p class="ai-prediction">
        â†’ {{ cp_set_text }}
    </p>

    <p>
        Out of <strong>100 similar past cases</strong>, the true outcome was
        <strong>included in this set in about {{ cp_coverage_correct }} cases</strong>
        and
        <strong>not included in about {{ cp_coverage_incorrect }} cases</strong>.
    </p>

    {% endif %}

</div>



<hr>

<!-- ========================= -->
<!-- Final decision -->
<!-- ========================= -->

<div class="question-box">
    {{ formfield 'final_decision' }}
</div>

<hr>

<p>{{form.final_confidence.label}}</p>
<table class="table table-bordered text-center scale-table">
    <tr>
        {% for choice in form.final_confidence %}
            <th style="width: 8%;">
                {{ choice.label }}
            </th>
        {% endfor %}
    </tr>

    <tr>
        <!-- Radio buttons -->
        {% for choice in form.final_confidence %}
            <td>
                {{ choice }}
            </td>
        {% endfor %}
    </tr>
</table>

<button class="otree-btn-next" onclick="getTime()">Continue</button>

{% endblock %}
